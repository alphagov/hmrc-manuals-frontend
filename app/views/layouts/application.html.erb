<!DOCTYPE html>
<html>
<head>
  <title><%= yield :title %> - GOV.UK</title>
  <!--[if gt IE 8]><!--><%= stylesheet_link_tag "application" %><!--<![endif]-->
  <!--[if IE 6]><%= stylesheet_link_tag "application-ie6" %><script>var ieVersion = 6;</script><![endif]-->
  <!--[if IE 7]><%= stylesheet_link_tag "application-ie7" %><script>var ieVersion = 7;</script><![endif]-->
  <!--[if IE 8]><%= stylesheet_link_tag "application-ie8" %><script>var ieVersion = 8;</script><![endif]-->
  <%= stylesheet_link_tag "print", media: "print" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <%= yield :extra_head_content %>
</head>
<body>
  <div id="global-breadcrumb" class="header-context"></div>
  <div id="wrapper">
    <main role="main" class="hmrc-internal-manuals-frontend-content outer-block">
      <div id="manuals-frontend" class='manuals-frontend-body inner-block'>
        <%= yield %>
        <div class="print-page">
          <%= link_to 'Print this page', '#', :onclick => 'window.print();return false;'%>
        </div>
      </div>
    </main>

    <script>
			function sendMessage(message) {
				return new Promise(function(resolve, reject) {
					var messageChannel = new MessageChannel();
					messageChannel.port1.onmessage = function(event) {
						if (event.data.error) {
							reject(event.data.error);
						} else {
							resolve(event.data);
						}
					};

					navigator.serviceWorker.controller.postMessage(message,
						[messageChannel.port2]);
				});
			}

			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.addEventListener('message', function(event) {
					console.log('message received in browser' + event.data);
				});

				navigator.serviceWorker.register('/sw.js')
					.then(function() {
						return navigator.serviceWorker.ready;
					})
					.then(() => {
						if (window.location.href !== "http://localhost:3072/guidance/style-guide") {
							return;
            }

						var button = $("<button class='save-offline'>Save for offline use</button>");
						$(".primary").append(button);

						button.click(function () {
							sendMessage('save-for-offline-use');
							button.addClass("saved");
							button.text("Saved!");
						});
					})
					.catch(function(error) { console.log(error) });
			} else {
				console.log("service workers unsupported");
			}
    </script>
  </div>
</body>
</html>
